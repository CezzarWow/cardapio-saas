RewriteEngine On

# ============================================
# GZIP COMPRESSION
# ============================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml
    AddOutputFilterByType DEFLATE text/css text/javascript application/javascript
    AddOutputFilterByType DEFLATE application/json application/xml
    
    # Adicionar Vary para evitar cache incorreto em proxies
    <IfModule mod_headers.c>
        Header append Vary Accept-Encoding
    </IfModule>
</IfModule>

# ============================================
# BROWSER CACHING
# ============================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Imagens: 1 mês
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
    
    # CSS/JS: 1 semana (sem fingerprinting)
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresByType text/javascript "access plus 1 week"
    
    # Fontes: 1 mês
    ExpiresByType font/woff2 "access plus 1 month"
    ExpiresByType font/woff "access plus 1 month"
</IfModule>

# Desabilitar ETag para cache longo
FileETag None
<IfModule mod_headers.c>
    Header unset ETag
</IfModule>

# Cache-Control genérico para assets (Apache 2.4+)
# Cache-Control para arquivos versionados (dist)
# Como usamos hash no nome (cardapio.abcdef.js), podemos cachear "para sempre" (1 ano)
<FilesMatch "cardapio\.[a-z0-9]+\.(js|css)$">
    <IfModule mod_headers.c>
        Header set Cache-Control "public, max-age=31536000, immutable"
    </IfModule>
</FilesMatch>

# Cache-Control genérico para assets (Apache 2.4+)
<FilesMatch "\.(css|js|jpg|jpeg|png|gif|svg|webp|woff|woff2|ttf|ico)$">
    <IfModule mod_headers.c>
        Header set Cache-Control "public, max-age=2592000"
    </IfModule>
    Require all granted
</FilesMatch>

# Redirecionar todo o tráfego para index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]